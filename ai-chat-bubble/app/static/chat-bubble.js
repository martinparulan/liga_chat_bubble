(()=>{let n="http://localhost:8080",e="/question_on_url",t="question",o=!0,a={},r={};try{const s="undefined"!=typeof document&&document.currentScript?document.currentScript:null,i="undefined"!=typeof window&&window.PHOSPHO_CHAT_BUBBLE_SERVER_URL?window.PHOSPHO_CHAT_BUBBLE_SERVER_URL:null,c=s?s.getAttribute("data-server-url"):null,l="undefined"!=typeof process&&process.env?"http://localhost:8080":null;n=i||c||l||n;const d=s?s.getAttribute("data-endpoint-path"):null,p=s?s.getAttribute("data-payload-key"):null,u=s?s.getAttribute("data-stream"):null,g=s?s.getAttribute("data-headers"):null,h=s?s.getAttribute("data-extra-payload"):null;if(d&&(e=d),p&&(t=p),null!==u&&(o=!("false"===u||"0"===u)),g)try{a=JSON.parse(g)}catch(n){}if(h)try{r=JSON.parse(h)}catch(n){}}catch(n){}const s=`${n}${e.startsWith("/")?"":"/"}${e}`;async function i(){try{const e=r.appName,t=r.userId,o="@auto"===r.sessionId||!r.sessionId;if(!e||!t)return null;const s=`phospho_chat_sid_${e}_${t}`;let i=null;if("undefined"!=typeof window&&window.localStorage&&(i=window.localStorage.getItem(s)),!i&&o){const o=`${n}/apps/${encodeURIComponent(e)}/users/${encodeURIComponent(t)}/sessions`,r=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",...a},body:JSON.stringify({userId:t})});if(r.ok){const n=await r.json().catch((()=>({})));i=n&&n.id?n.id:null,i&&window.localStorage&&window.localStorage.setItem(s,i)}}return i}catch(n){return null}}const c=document.createElement("style");c.textContent="\n* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n    font-family: 'Inter', sans-serif; /* Using a modern sans-serif font like Inter */\n}\n\n/* Chat Bubble (Floating button) */\n.chat-bubble {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    width: 60px;\n    height: 60px;\n    background: #3e8ef7;\n    border-radius: 50%;\n    cursor: pointer;\n    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.3s ease;\n    z-index: 1000;\n}\n\n.chat-bubble:hover {\n    transform: scale(1.1);\n}\n\n.chat-bubble-icon {\n    font-size: 28px;\n}\n\n/* Chat Window Modal */\n.chat-window {\n    position: fixed;\n    bottom: 90px;\n    right: 20px;\n    width: 350px;\n    height: 450px;\n    background: #1e1e1e;\n    border-radius: 16px;\n    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);\n    display: none;\n    flex-direction: column;\n    z-index: 1000;\n    opacity: 0;\n    transform: translateY(30px);\n    transition: opacity 0.3s ease, transform 0.3s ease;\n}\n\n.chat-window.active {\n    display: flex;\n    opacity: 1;\n    transform: translateY(0);\n    background: #1e1e1e;\n}\n\n/* Header */\n.chat-header {\n    padding: 16px;\n    background: #1e1e1e;\n    color: white;\n    font-size: 16px;\n    font-weight: 600;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-top-left-radius: 16px;\n    align-self: flex-end;\n    border-top-right-radius: 16px;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.close-button {\n    background: none;\n    border: none;\n    color: white;\n    cursor: pointer;\n    font-size: 18px;\n    transition: color 0.3s ease;\n}\n\n.close-button:hover {\n    color: #3e8ef7;\n}\n\n/* Chat Messages Section */\n.chat-messages {\n    flex-grow: 1;\n    padding: 20px;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    gap: 14px;\n    background: #1e1e1e;\n}\n\n.message {\n    padding: 12px 18px;\n    border-radius: 20px;\n    max-width: 80%;\n    word-wrap: break-word;\n    font-size: 14px;\n    line-height: 1.4;\n}\n\n.message.sent {\n    background: #2A2A2A;\n    color: white;\n    align-self: flex-end;\n}\n\n.message.received {\n    background: #3e8ef7;\n    color: white;\n    align-self: flex-start;\n}\n\n/* Chat Input Section */\n.chat-input {\n    display: flex;\n    padding: 16px;\n    gap: 12px;\n    background: #1e1e1e;\n}\n\n.message-input {\n    flex-grow: 1;\n    padding: 12px 18px;\n    border: 1px solid #e0e0e0;\n    border-radius: 30px;\n    outline: none;\n    font-size: 14px;\n    transition: border-color 0.3s ease;\n}\n\n.message-input:focus {\n    border-color: #3e8ef7;\n}\n\n.send-button {\n    background: #3e8ef7;\n    color: white;\n    border: none;\n    border-radius: 30px;\n    padding: 0px 16px;\n    cursor: pointer;\n    transition: background 0.3s ease;\n    font-size: 24px;\n    align-items: center;\n}\n\n.send-button:hover {\n    background: #3378d1;\n}\n\n.send-button:active {\n    background: #2566a0;\n}\n\n\n.phospho-typing-indicator {\n  padding: 10px;\n  display: flex;\n  align-items: center;\n}\n\n.typing-dots {\n  display: flex;\n  align-self: flex-start;\n}\n\n.typing-dots span {\n  height: 8px;\n  width: 8px;\n  margin: 0 4px;\n  background-color: #3e8ef7;\n  display: block;\n  border-radius: 50%;\n  opacity: 0.4;\n  animation: typing 1s infinite ease-in-out;\n  align-self: flex-start;\n}\n\n.typing-dots span:nth-child(1) {\n  animation-delay: 0.1s;\n}\n\n.typing-dots span:nth-child(2) {\n  animation-delay: 0.2s;\n}\n\n.typing-dots span:nth-child(3) {\n  animation-delay: 0.3s;\n}\n\n.highlighted-link {\n  text-decoration: underline;\n  color: rgb(255, 255, 255);\n}\n\n/* Copy button styling */\n.copy-btn {\n  position: absolute;\n  top: 5px;\n  right: 5px;\n  background-color: #444;\n  color: #e6e6e6;\n  border: none;\n  border-radius: 3px;\n  padding: 2px 5px;\n  font-size: 12px;\n  cursor: pointer;\n}\n\n.copy-btn:hover {\n  background-color: #555;\n}\n\n\n/* Code block styling */\npre {\n  background-color: #2b2b2b;\n  border: 1px solid #444;\n  border-radius: 4px;\n  padding: 10px;\n  overflow-x: auto;\n  position: relative;\n}\n\ncode {\n  font-family: 'Courier New', Courier, monospace;\n  font-size: 14px;\n  color: #2b2b2b;\n}\n\n/* Inline code styling */\np code {\n  background-color: #2c2f33;\n  color: #e6e6e6;\n  padding: 2px 4px;\n  border-radius: 3px;\n}\n\n/* Fade In Animation */\n.chat-window.fade-in {\n    animation: fadeIn 0.3s forwards;\n}\n\n@media (max-width: 767px) {\n  .chat-window {\n    width: 100%;\n    height: 100%;\n    border-radius: 0;\n    bottom: 0;\n    right: 0;\n  }\n\n  .chat-messages {\n    max-height: 70%;\n  }\n\n  .chat-input {\n    flex-wrap: wrap;\n  }\n\n  .message-input {\n    flex-grow: 1;\n    width: 100%;\n  }\n\n  .send-button {\n    margin-top: 12px;\n    font-size: 40px;\n  }\n}\n\n@keyframes typing {\n  0% {\n    transform: translateY(0px);\n    background-color: #0000ff;\n  }\n  28% {\n    transform: translateY(-7px);\n    background-color: #3e8ef7;\n  }\n  44% {\n    transform: translateY(0px);\n    background-color: #0000ff;\n  }\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n        transform: translateY(30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}",document.head.appendChild(c);const l=document.createElement("div");l.className="chat-bubble",l.innerHTML='<span class="chat-bubble-icon">ðŸ’¬</span>',document.body.appendChild(l);const d=document.createElement("div");d.className="chat-window",d.innerHTML='\n  <div class="chat-header">\n    <button class="close-button"></button>\n  </div>\n  <div class="chat-messages"></div>\n  <div class="chat-input">\n    <input type="text" class="message-input" placeholder="Type a message...">\n    <button class="send-button">â†‘</button>\n  </div>\n',document.body.appendChild(d);const p=d.querySelector(".close-button"),u=d.querySelector(".chat-messages"),g=d.querySelector(".message-input"),h=d.querySelector(".send-button");let f=!1;function b(){f=!1,l.querySelector(".chat-bubble-icon").textContent=f?"âŒ‘":"ðŸ’¬",d.classList.remove("active")}function x(n,e=!0){const t=document.createElement("div");t.className="message "+(e?"sent":"received"),t.textContent=n,u.appendChild(t),u.scrollTop=u.scrollHeight}function m(n){y();let e=u.querySelector(".message.received:last-child");e||(e=document.createElement("div"),e.className="message received",e.innerHTML="<p></p>",u.appendChild(e));const t=function(n){return n=(n=(n=(n=n.replace(/```(\w+)?\n([\s\S]*?)```/g,((n,e,t)=>{return`<pre><code class="language-${e||""}">${o=t.trim(),o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}</code></pre>`;var o}))).replace(/`([^`]+)`/g,"<code>$1</code>")).replace(/\$\$([\s\S]*?)\$\$/g,((n,e)=>`<div class="latex-container">${e}</div>`))).replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^\s*\n\*/gm,"<ul>\n*").replace(/^(\*\s.*)\n([^\*])/gm,"$1\n</ul>\n\n$2").replace(/^\*\s(.*)/gm,"<li>$1</li>").replace(/\[([^\]]+)\]\(([^\)]+)\)/g,'<a href="$2" class="highlighted-link" target="_blank">$1</a>').replace(/^\s*(\n)?(.+)/gm,(function(n){return/\<(\/)?(h\d|ul|ol|li|blockquote|pre|img)/.test(n)?n:"<p>"+n+"</p>"}))}(n);e.querySelector("p").innerHTML=t,e.querySelectorAll("pre").forEach((n=>{if(!n.querySelector(".copy-btn")){const e=document.createElement("button");e.textContent="Copy",e.className="copy-btn",e.addEventListener("click",(()=>{const t=n.querySelector("code").textContent;navigator.clipboard.writeText(t).then((()=>{e.textContent="Copied!",setTimeout((()=>{e.textContent="Copy"}),2e3)}))})),n.appendChild(e)}})),u.scrollTop=u.scrollHeight}function y(){const n=u.querySelector(".typing-indicator");n&&n.remove()}async function w(){const n=g.value.trim();if(n){x(n,!0),g.value="",function(){y();const n=document.createElement("div");n.className="message bot typing-indicator",n.innerHTML='<div class="typing-dots"><span></span><span></span><span></span></div>',u.appendChild(n),u.scrollTop=u.scrollHeight}();try{try{const n=await i();!n||r.sessionId&&"@auto"!==r.sessionId||(r.sessionId=n)}catch(n){}const e={...r};try{((n,e,t)=>{if(!e)return;const o=[];e.split(".").forEach((n=>{const e=/([^\[]+)|(\[(\d+)\])/g;let t;for(;null!==(t=e.exec(n));)t[1]?o.push(t[1]):void 0!==t[3]&&o.push(Number(t[3]))}));let a=n;for(let n=0;n<o.length;n+=1){const e=o[n];if(n===o.length-1){a[e]=t;break}const r="number"==typeof o[n+1];void 0===a[e]&&(a[e]=r?[]:{}),a=a[e]}})(e,t,n)}catch(o){e[t]=n}let c=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",...a},body:JSON.stringify(e)});if(404===c.status||422===c.status)try{const n=await c.text();if(n&&/Session not found/i.test(n)){const n=await i();n&&(e.sessionId=n,c=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",...a},body:JSON.stringify(e)}))}}catch(n){}if(c.ok)if(o&&c.body instanceof ReadableStream){const n=c.body.getReader(),e=new TextDecoder;let t="",o="";const a=n=>{try{if(n.error)return`Error: ${n.error}`;const e=n.content;if(!e||!e.parts)return"";return(Array.isArray(e.parts)?e.parts:[]).map((n=>n&&n.text?n.text:"")).join("")}catch(n){return""}},r=()=>{const n=[],e=t.split(/\n\n/);t=e.pop()||"";for(const t of e){const e=t.split(/\n/).filter((n=>n.startsWith("data:"))).map((n=>n.replace(/^data:\s?/,""))).join("\n").trim();if(e)try{const t=JSON.parse(e);n.push(t)}catch(n){}}return n},s=async()=>{const{done:i,value:c}=await n.read();if(i)return void y();t+=e.decode(c,{stream:!0});const l=r();for(const n of l){const e=a(n);e&&(o+=e,m(o))}s()};await s()}else{let n="";if((c.headers.get("content-type")||"").includes("application/json")){const e=await c.json().catch((()=>null));e&&(n=e.output||e.text||JSON.stringify(e))}else n=await c.text();m(n||""),y()}else y(),console.error("Error with the request:",c.statusText)}catch(n){y(),console.error("Error:",n)}}}x("Hello! How can I assist you today?",!1),l.addEventListener("click",(function(){f=!f,d.classList.toggle("active",f),l.querySelector(".chat-bubble-icon").textContent=f?"âŒ‘":"ðŸ’¬",f&&g.focus()})),p.addEventListener("click",b),h.addEventListener("click",w),g.addEventListener("keypress",(n=>{"Enter"===n.key&&w()})),document.addEventListener("click",(n=>{!f||d.contains(n.target)||l.contains(n.target)||b()}))})();